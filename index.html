<!DOCTYPE html>
<html data-blockbyte-bs-uid="86074">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>4Me Writer</title>
    <link rel="shortcut icon" href="http://write4me.sinaapp.com/favicon4me.png">
    <link rel="stylesheet" href="./4Me_Writer_files/codemirror.css">
    <script src="./4Me_Writer_files/codemirror.js"></script>
    <script src="./4Me_Writer_files/xml.js"></script>
    <script src="./4Me_Writer_files/markdown.js"></script>
    <script src="./4Me_Writer_files/jquery.min.js"></script>
    <script src="./4Me_Writer_files/jquery.fullscreen.js"></script>

    <style id="control"></style>
    <style type="text/css">
        *{
            font-family: var(--mainfont);
        }

        html{
            height:100%;
        }

        *::selection {
            background-color: var(--selection) !important;
        }

        *::-moz-selection {
            background-color: var(--selection) !important;
        }

        *::-webkit-selection {
            background-color: var(--selection) !important;
        }

        /*滚动条*/
        ::-webkit-scrollbar {
            width: 7px;
            background-color: #0000;
        }

        ::-webkit-scrollbar-track {
            background-color: #0000;
        }

        ::-webkit-scrollbar-thumb {
            background-color: var(--line) !important;
            border-radius:7px;
        }

        #board {
            height: 80%;
            margin:5% 5% 0 5%;
            overflow:auto;
        }

        #ctn,
        #ctn > form{
            height:100%;
        }

        .CodeMirror {
            line-height: 35px;
            font-family: var(--mainfont),monospace;
            font-size: 20px;
            background: var(--background);
            color: #aaa;
            height: 100%;
        }

        a {
            color: #aaa;
            text-decoration: none;
        }

        #save_btn {
            float: right;
            margin-right: 100px;
            margin-top: 2%;
        }

            #opitions{
                position:fixed;
                top:0;
                left:0;
                background:var(--darkback);
                box-shadow:#0003 0 3px 15px;
                width:100%;
                height:40px;
                opacity:0;
                color:var(--active);
                transition:all 1s;
                z-index:999;
            }

            #opitions:hover{
                opacity:1;
                transition:all .2s;
            }

            #opitions strong{
                color:var(--main);
                font-size:18px;
                line-height:40px;
                margin-left:2%;
            }

            #opitions span{
                font-size:16px;
                line-height:40px;
                margin-left:1.5%;
            }

            #opitions button,
            #opitions a{
                background:var(--background);
                color:var(--active);
                border-radius:3px;
                border:none;
                box-shadow:#0003 2px 0 10px;
                padding:5px 20px;
                margin:5px .5% 5px .5%;
                outline: none;
                line-height:20px;
                cursor:pointer;
                font-size:13px;
                transition:all .2s;
            }

            #opitions button:hover,
            #opitions a:hover{
                transform: scale(1.07);
            }

                #opitions button:active,
                #opitions a:active{
                    transform: scale(.9);
                }

        body, html {
            background: var(--background);
            font-family: var(--mainfont),monospace;
        }

        
    </style>
    <style id="transition"></style>
</head>
<body onunload="save_content()" id="board">
    <div id="opitions">
        <strong>4Me Writer</strong>
        <span>主题</span>
        <button id="theme" onclick="set_theme()">亮</button>
        <span>行号</span>
        <button id="num" onclick="set_line_num()">关</button>
        <span onclick="set_stick()" id="stick" style="cursor:pointer">📌</span>
        <a id="save_btn" href="javascript:$(&#39;#save_form&#39;).submit();void(0);">另存为...</a>
    </div>
    <div id="ctn">
        <form action="http://write4Me.sinaapp.com/save.php" method="post" target="_blank" id="save_form">
            <textarea id="code" name="code" style="display: none;"># 为什么制作 4Me Writer
> 其实写作，最需要的并不是很好很强大的工具，而是一个不易让人分心的环境。
Mac上的 iA Writer 固然能很好地做到这一点，但作为一个初二学生，我确实也没有那个闲钱去买正版（毕竟Win端一百多块，Mac端两百多块）。我找到了一个类似的软件，叫做 4Me 写字板，[原链接，现已失效](write.4meapp.com)。但是，它和 iA Writer的差距未免也太大了……
4Me 写字板基于 CodeMirror，很方便自定义。
我最近在尝试联系原作者，本来想问一下有没有挂版权什么的。不过貌似现在的这个 4Me 写字板是一个镜像，[链接在此](http://write4me.sinaapp.com) 。页面上虽然有写 4Me 设计出品，但点击之后跳转出来的是一个不存在的页面。原作者可能无力维护服务器了，于是现在将其托管在新浪云上。
于是我借着这次因武汉肺炎疫情宅家的事件，尝试自己以 4Me 写字板为基础加以改进。反正经历了一通大修大改，我做出了这个至少长得很像 iA Writer 的文本编辑器。
我不知道应该取一个什么名字，于是就把“写字板”三个字改成了“Writer”，取名为 “4Me Writer”，也算是对原作者的一个尊重了。我将这个项目开源在 Github 上面，如果原作者有看到，不希望开源，可以联系我邮箱 [邮箱](linhongping1219@163.com) 。

# 4Me Writer 和原来的 4Me 写字板的区别
- 加入可选的暗色模式；
- 加入可选的行号；
- 加入半隐藏的滚动条（4Me 写字板本来是直接去掉滚动条的（overflow: hidden），但牺牲了用户体验）；
- 优化了光标的观感（为此还特意修改了一下 CodeMirror.js）；
- 加入了一个隐藏式的顶栏（当然也可以选择不隐藏）；
- 把“保存到电脑”按钮挪到了右上角；
- 实现了布局自适应（不过对移动端还是不太友好）。
暂时就这么多，以后再慢慢优化。

# 4Me Writer 和 iA Writer 的区别
- iA Writer 可以实现高亮当前句子或段落，而 4Me Writer 只能高亮当前段落，而且是必选的；
- 4Me Writer 不具备 iA Writer 的语法高亮，如果真的有需要，可以试一试这个 Chrome 扩展[English Syntax Hightlighter](https://chrome.google.com/webstore/detail/ikdjjgioalkbdihbhcfffjnanhnilipa)；
- 4Me Writer 不具备 iA Writer 统计单词数量和阅读所需时间的功能；
其实我觉得虽然没有这些功能，4Me Writer 也算还行吧。反正，以后有时间慢慢加吧。
</textarea>
        </form>
        <div id="save_info"></div>
    </div>

    <script>
        document.getElementById("opitions").style.opacity = "1";

        (function () {
            var
                fullScreenApi = {
                    supportsFullScreen: false,
                    isFullScreen: function () { return false; },
                    requestFullScreen: function () { },
                    cancelFullScreen: function () { },
                    fullScreenEventName: '',
                    prefix: ''
                },
                browserPrefixes = 'webkit moz o ms khtml'.split(' ');

            // check for native support
            if (typeof document.cancelFullScreen != 'undefined') {
                fullScreenApi.supportsFullScreen = true;
            } else {
                // check for fullscreen support by vendor prefix
                for (var i = 0, il = browserPrefixes.length; i < il; i++) {
                    fullScreenApi.prefix = browserPrefixes[i];

                    if (typeof document[fullScreenApi.prefix + 'CancelFullScreen'] != 'undefined') {
                        fullScreenApi.supportsFullScreen = true;

                        break;
                    }
                }
            }

            // update methods to do something useful
            if (fullScreenApi.supportsFullScreen) {
                fullScreenApi.fullScreenEventName = fullScreenApi.prefix + 'fullscreenchange';

                fullScreenApi.isFullScreen = function () {
                    switch (this.prefix) {
                        case '':
                            return document.fullScreen;
                        case 'webkit':
                            return document.webkitIsFullScreen;
                        default:
                            return document[this.prefix + 'FullScreen'];
                    }
                }
                fullScreenApi.requestFullScreen = function (el) {
                    return (this.prefix === '') ? el.requestFullScreen() : el[this.prefix + 'RequestFullScreen']();
                }
                fullScreenApi.cancelFullScreen = function (el) {
                    return (this.prefix === '') ? document.cancelFullScreen() : document[this.prefix + 'CancelFullScreen']();
                }
            }

            // jQuery plugin
            if (typeof jQuery != 'undefined') {
                jQuery.fn.requestFullScreen = function () {

                    return this.each(function () {
                        var el = jQuery(this);
                        if (fullScreenApi.supportsFullScreen) {
                            fullScreenApi.requestFullScreen(el);
                        }
                    });
                };
            }
            // export api
            window.fullScreenApi = fullScreenApi;
        })();
        const darktheme = "*{--background:#1A1C1D;--darkback:#252829;--main:#00BAFF;--selection:#fff2;--active:#fff;--mainfont: 'NeverMind','Noto Sans S Chinese' !important;--line: #333;--com:#fff1;}";
        const lighttheme = "*{--background:#f8f8f8;--darkback:#eee;--main:#00BAFF;--selection:#ace8ff;--active:#333;--mainfont: 'NeverMind','Noto Sans S Chinese' !important;--line: #ddd;--com:#0001;}";
        const transition = "body,html,.CodeMirror,.cm-comment{transition:background .3s}.CodeMirror-gutter{transition:all .3s}";
        var stick=0;
        if (localStorage.theme)
            if (localStorage.theme == 1) {
                document.getElementById("control").innerHTML = lighttheme;
            }
            else {
                document.getElementById("control").innerHTML = darktheme;
                document.getElementById("theme").innerHTML = "暗";
            }
        else {
            localStorage.theme = 1;
            document.getElementById("control").innerHTML = lighttheme;
        }

        if (localStorage.line_num) {
            if (localStorage.line_num==2) {
                document.getElementById("num").innerHTML = "开";
            }
        }
        else localStorage.line_num = 1;

        var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
            lineNumbers: (localStorage.line_num-1),
            lineWrapping: true,
            mode: 'markdown',
            onCursorActivity: function () {

                editor.setLineClass(hlLine, null);
                hlLine = editor.setLineClass(editor.getCursor().line, "activeline");

                $("pre.activeline ~ pre").addClass('activeline');
                //console.log($("pre.activeline ~ pre"));
            }
        });

        
        
        function set_theme() {
            if (localStorage.theme == 1) {
                document.getElementById("control").innerHTML = darktheme;
                document.getElementById("theme").innerHTML = "暗";
                localStorage.theme = 2;
            }
            else {
                document.getElementById("control").innerHTML = lighttheme;
                document.getElementById("theme").innerHTML = "亮";
                localStorage.theme = 1;
            }
        }
        function set_line_num() {
            editor.save();
            if (localStorage.line_num == 1) localStorage.line_num = 2;
            else localStorage.line_num = 1;
            window.history.go(0);
        }
        function set_stick() {
            if (stick == 0) {
                document.getElementById('opitions').style.opacity = '1';
                stick = 1;
                document.getElementById('stick').innerHTML = '📍';
            }
            else {
                document.getElementById('opitions').style.opacity = '';
                stick = 0;
                document.getElementById('stick').innerHTML = '📌';
            }
        }

        var hlLine = editor.setLineClass(0, "activeline");

        var local_save = setInterval(save_content, 300000);

        var glvar_isCtrl = false;
        var glvar_ctrlDownTime = 0;

        var skey = window.location;

        setTimeout("document.getElementById('transition').innerHTML = transition;", 300 )
        setTimeout("document.getElementById('opitions').style.opacity = '';", 1000)


        function playSound(url) {
            $("#sound").html("<embed src='" + url + "' hidden=true autostart=true loop=false>");
        }

        function save_content(user) {
            editor.save();
            window.localStorage.setItem(skey, $('#code').val());
            var d = new Date();
            var curr_hour = d.getHours();
            var curr_min = d.getMinutes();

            if (user == 1)
                $('#save_info').html('保存于 ' + curr_hour + '点' + curr_min + '分');
            else
                $('#save_info').html('自动保存于 ' + curr_hour + '点' + curr_min + '分');
        }

        $(document).ready(function () {

            if (window.localStorage.getItem(skey) !== null) editor.setValue(window.localStorage.getItem(skey));
            else {
                editor.setCursor(3, 22);
                editor.focus();
            }

            $(document).keyup(function (e) {
                if (e.which == 17 || e.which == 224) {
                    glvar_isCtrl = false;
                }

            }).keydown(function (e) {

                if (e.which == 17 || e.which == 224) {
                    glvar_isCtrl = true;
                    glvar_ctrlDownTime = Date.parse(new Date());
                    return false;
                }

                //Ctrl + s
                if (glvar_isCtrl == true) {
                    var curtime = Date.parse(new Date());
                    var timedf = curtime - glvar_ctrlDownTime;
                    if (e.which == 83 && timedf <= 2000) {
                        save_content(1);
                        return false;
                    }
                }
            });
        });

    </script>
</body>
</html>
